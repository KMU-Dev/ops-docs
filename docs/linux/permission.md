---
sidebar_position: 5
---

# 檔案權限與帳號管理

Linux 是一個多工多使用者的作業系統，因此使用者管理和檔案權限對於系統管理就相當重要了。

## Linux 權限

Linux 權限的目的是在『保護某些人的檔案資料』，因此，讀者在認識『權限』的角度上，應該要思考的是『這個檔案的權限設定後， 會造成哪個個人？或某群人的讀寫開放或保護』。所以，這些權限最終都是『應用在某個/某群帳號』上面！而且，權限都是『設定在檔案/目錄』上， 不是設定在帳號上面的，這也要先釐清。

### 使用者、群組與其他人

Linux 的檔案權限在設定上，主要依據三種身份來決定，包括：

- **user** / owner / 檔案擁有者 / 使用者：就是檔案所屬人
- **group** / 群組：這個檔案附屬於那一個群組團隊
- **others** / 其他人：不是 user 也沒加入 group 的帳號，就是其他人。

### 檔案權限

單純的檔案權限觀察，可以使用 ls -l 來查閱

```
[student@localhost ~]$ ls -ld /var/spool/mail
drwxrwxr-x. 2 root mail 32    2月 26 09:10 /var/spool/mail
[    A    ][B][C ] [D ] [E ]  [    F     ] [    G        ]
```

簡單的分析，上述的資料共有七個欄位，每個欄位的意義為：

A. 檔案類型與權限，第 1 個字元為檔案類型，後續 9 個字元每 3 個一組，共分 3 組，為三種身份的權限；  
B. 檔案連結數，這與檔案系統有關，讀者可暫時略過；  
C. 該檔案的擁有者，本例當中，擁有者身份為 root  
D. 該檔案的所屬群組，本例當中這個檔案屬於 mail 這個群組底下  
E. 這個檔案的容量  
F. 該檔案最後一次被修改/修訂的日期時間  
G. 這個檔案的檔名。  

讀者首先可以分析一下這個『檔案』的『類型』。之前讀者應該看過第一個字元為 - 以及 d 的表示方式，事實上還有很多常見的檔案類型， 底下僅為常見的類型介紹：

- **-**: 代表後面的檔名為一般檔案
- **d**: 代表後面的檔名為目錄檔
- **l**: 代表後面的檔名為連結檔 (有點類似 windows 的捷徑概念)
- **b**: 代表後面的檔名為一個裝置檔，該裝置主要為區塊裝置，亦即儲存媒體的裝置較多
- **c**: 代表後面的檔名為一個週邊裝置檔，例如滑鼠、鍵盤等

權限：

- **r**: read，可讀的意思
- **w**: write，可寫入/編輯/修改的意思
- **x**: eXecutable，可以執行的意思

### 目錄權限

檔案是存放實際資料的所在，而目錄主要的內容在記錄檔名清單，檔名與目錄有強烈的關連。如果是針對目錄時，rwx 的意義如下：

- **r (read contents in directory)**：
    表示具有讀取目錄結構清單的權限，所以當用戶具有讀取(r)一個目錄的權限時，表示該用戶可以查詢該目錄下的檔名資料。
- **w (modify contents of directory)**：
    當用戶具有目錄的 w 權限時，表示用戶具有異動該目錄結構清單的權限，也就是底下這些權限：
    建立新的檔案與目錄；
    刪除已經存在的檔案與目錄(不論該檔案的權限為何！)
    將已存在的檔案或目錄進行更名；
    搬移該目錄內的檔案、目錄位置。
- **x (access directory)**：
    目錄的x代表的是使用者能否進入該目錄成為工作目錄的用途！

### 檔案目錄權限比較表

| 元件 | 內容 | 思考物件 | r | w | x |
| ---- | --- | -------- | - | - | - |
| 檔案 | 詳細資料data | 文件資料夾 | 讀到文件內容 | 修改文件內容 | 執行文件內容 |
| 目錄 | 檔名 | 可分類抽屜 | 讀到檔名 | 修改檔名 | 進入該目錄的權限(key) |


### 觀察帳號與權限的相關指令

```bash
id $USER
```

## 修改權限

### `chown` 修改使用者

```bash
chown user file
```

### `chgrp` 修改群組

```bash
chgrp grp file
```

### chmod 修改權限

由於檔案紀錄了三種身份，每種身份都擁有 rwx 的最大權限與 --- 沒權限的情況。為了搭配性的方便，於是使用 2 位元的方法來記憶！ 亦即是 2 進位的情況：

- r ==> read    ==> 4
- w ==> write   ==> 2
- x ==> eXecute ==> 1